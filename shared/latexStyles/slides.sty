%%
%% This LaTeX package is intented to provide a uniform and good appearance
%% for slides which present features of the optimizationBenchmarking.org
%% experimental framework.
%%
%% It requires that a command \sharedPath is provided which points to the
%% path of the "shared" folder in the documentation file hierarchy.
%%
%%
%%%
%%% Load all required packages
%%%
%
%%%
%%% Load CJKutf8 to be able to print Chinese characters
%%% Provide command \zh to enable us to write Chinese characters
%%%
\let\internalBegin\begin%
\let\internalEnd\end%
\RequirePackage{CJKutf8}%
\protected\gdef\zh#1{\internalBegin{CJK}{UTF8}{gbsn}#1\internalEnd{CJK}}%
%%%
%%% Load hyperref to make links clickable
%%%
\RequirePackage{hyperref}%
%%%
%%% Load natbib for references
%%%
\RequirePackage[square,numbers,comma,sort&compress]{natbib}%
\bibpunct{[}{]}{,}{n}{, }{,}%
\gdef\bibnumfmt#1{#1.}%
\setlength{\bibsep}{0mm}%
%%%
%%% Load etoolbox for making slides have entries in bookmarks
%%%
\RequirePackage{bookmark}%
\RequirePackage{etoolbox}%
%
%%%
%%% Basic color definitions
%%%
\usecolortheme{orchid}%
\useinnertheme{rectangles}%
\useoutertheme{infolines}%
%
\definecolor{footerdarkblue}{rgb}{0.04,0.13333333333333333333333333333333,0.6039215686274509803921568627451}%
\definecolor{blockbgblue}{rgb}{0.77647058823529411764705882352941,0.85098039215686274509803921568627,0.94509803921568627450980392156863}%
\definecolor{blocktitlebgblue}{rgb}{0.5,0.6,0.9}%
\definecolor{alertviolet}{rgb}{0.43921568627450980392156862745098,0.18823529411764705882352941176471,0.62745098039215686274509803921569}%
\definecolor{alertvioletB}{rgb}{0.8,0.75294117647058823529411764705882,0.85098039215686274509803921568627}%
\definecolor{alertvioletC}{rgb}{0.619607843137254901960784313725,0.470588235294117647058823529411,0.7392156862745098039215686274505}%
\definecolor{exampleBody}{rgb}{0.91764705882352941176470588235294,0.94509803921568627450980392156863,0.86666666666666666666666666666667}%
\definecolor{exampleHead}{rgb}{0.57254901960784313725490196078431,0.81568627450980392156862745098039,0.31372549019607843137254901960784}%
%
\setbeamercolor*{palette primary}{use=structure,fg=white,bg=structure.fg}%
\setbeamercolor*{palette secondary}{use=structure,fg=white,bg=structure.fg!75!black}%
\setbeamercolor*{palette tertiary}{use=structure,fg=white,bg=structure.fg!50!black}%
\setbeamercolor*{palette quaternary}{fg=white,bg=black}%
%
\setbeamercolor*{title}{parent=palette primary,fg=white}%
%
\setbeamercolor*{block title}{use=structure,fg=black,bg=blocktitlebgblue}%
\setbeamercolor*{block title alerted}{parent=block title}%
\setbeamercolor*{block title example}{parent=block title,bg=exampleHead}%
\setbeamercolor*{block body}{parent=palette primary,fg=black,bg=blockbgblue}%
\setbeamercolor*{block body alerted}{parent=block body}%
\setbeamercolor*{block body example}{parent=block body,bg=exampleBody}%
\setbeamercolor*{alerted text}{parent=palette primary, fg=alertviolet}%
%
\setbeamercolor*{block title alerted}{fg=black,bg=alertvioletC}%
\setbeamercolor*{block body alerted}{fg=black,bg=alertvioletB}%
%
\setbeamercolor*{frametitle}{fg=yellow!260!white}%
\setbeamercolor*{framesubtitle}{fg=black}%
%
%%%
%%% Templates for different slide elements
%%%
\setbeamertemplate{bibliography item}[book]%
%
\setbeamertemplate{items}[ball]%
\setbeamertemplate{item}[ball]%
\setbeamercolor{subitem projected}{bg=blocktitlebgblue}%
\setbeamercolor{item projected}{bg=blocktitlebgblue}%
\setbeamercolor{items projected}{bg=blocktitlebgblue}%
%
\setbeamertemplate{sections/subsections in toc}[ball]%
\setbeamerfont{section number projected}{family=\sffamily,series=\bfseries,size=\normalsize}%
%
\setbeamertemplate{title page}[default][colsep=-4bp,rounded=false,shadow=true]
\setbeamertemplate{part page}[default][colsep=-4bp,rounded=false,shadow=true]
%
\defbeamertemplate*{headline}{BLANK}{}%
%
\setbeamersize{text margin left=1em,text margin right=1em}%
%
%%%
%%% Some internal commands to get headlines nicely vertically aligned.
%%% 
\newlength{\@blabtmpFTL}%
\newsavebox{\@blabtmpFTLbox}%
\defbeamertemplate*{frametitle}{UBRI}{%
\vspace*{3pt}%
\savebox{\@blabtmpFTLbox}{\mbox{{\usebeamerfont{frametitle}{\insertframetitle}}}}%
\usebeamerfont{frametitle}{%
\setlength{\@blabtmpFTL}{\ht\@blabtmpFTLbox}%
\addtolength{\@blabtmpFTL}{\dp\@blabtmpFTLbox}%
\addtolength{\@blabtmpFTL}{-20pt}%
\setlength{\@blabtmpFTL}{0.5\@blabtmpFTL}%
\vspace*{-\@blabtmpFTL}%
\usebox\@blabtmpFTLbox%
}%
}%
%
%%
%% Font definitions for titles and that alike.
%%
%
\setbeamerfont{title}{parent=titlelike,size*={16}{0},series=\bfseries}%
\setbeamerfont{frametitle}{parent=titlelike,size*={12}{0},series=\bfseries}%
%
%%%
%%% The definition for the title page.
%%%
\defbeamertemplate*{title page}{UBRI}[1][]{%
\vbox{}%
\strut\vfill\strut%
\begin{centering}%
\vfill\vfill\vfill\vfill%
{\usebeamercolor[fg]{title}\usebeamerfont{title}\inserttitle}%
\vfill%
\begingroup{\ifx\insertsubtitle\empty%
\else%
\usebeamercolor[fg]{title}\usebeamerfont{title}\large{\insertsubtitle}
\vfill%
\fi}\endgroup%
\begin{beamercolorbox}[center,#1]{author}%
\usebeamercolor[bg]{frametitle}\usebeamerfont{author}\insertauthor%
\end{beamercolorbox}\vfill%
\begin{beamercolorbox}[center,#1]{institute}%
\usebeamercolor[fg]{title}\usebeamerfont{institute}\insertinstitute%
\end{beamercolorbox}\vfill%
\begin{beamercolorbox}[center,#1]{date}%
\usebeamercolor[fg]{title}\usebeamerfont{date}\insertdate%
\end{beamercolorbox}%
\end{centering}
\vfill\vfill\vfill\vfill\vfill%
}%
%
%
%%%
%%% Auxilliary definitions.
%%%
\defbeamertemplate*{navigation symbols}{UBRI}{}%
%
\setbeamerfont{block title example}{parent={block title},size=\footnotesize}%
\setbeamerfont{block body example}{parent={block body},size=\footnotesize}%
\setbeamerfont{example text}{parent={normal text},size=\footnotesize}%
%
\setbeamertemplate{blocks}[rounded][shadow=true]
%
%
%
%
%
%%%
%%% Call \startPresentation at the beginning of the presentation to make
%%% the title and the outline slides as well as to set the proper background
%%% graphics
%%%
%
\gdef\startPresentation{%
%
\setbeamertemplate{footline}{}%
%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\includegraphics[width=1.01\paperwidth,height=1.01\paperheight]{%
\sharedPath/graphics/ustc_slides_cover/ustc_slides_cover}}%
%
\begin{frame}%
\titlepage%
\end{frame}%
%
%
\defbeamertemplate*{footline}{UBRI}{%
{\color{footerdarkblue}%
\strut\hfill%
{\insertshorttitle}, {\insertshortdate{}}%
\hfill\hfill%
{\insertshortauthor}%
\hfill\hfill%
{{\insertframenumber{}}/{\inserttotalframenumber}}%
\hfill\strut
\vskip2pt%
}}%
%
%
\pgfdeclareimage[width=1.01\paperwidth,height=1.01\paperheight]{ustc_slides_background}{%
\sharedPath/graphics/ustc_slides_background/ustc_slides_background}%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\pgfuseimage{ustc_slides_background}}%
%
\begin{frame}%
\frametitle{Outline}%
\tableofcontents%
\end{frame}%
%
}%
%
%%%
%%% Call \endPresentation to mark the official end of the presentation.
%%% It may or may not add a slide with references.
%%% After this, you may still add appendix slides.
%%%
\gdef\endPresentation{%
%
\global\let\@framePatch\@framePatch@doNothing%
%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\includegraphics[width=1.01\paperwidth,height=1.01\paperheight]{%
\sharedPath/graphics/ustc_slides_final/ustc_slides_final}}%
%
\begin{frame}%
\pdfbookmark[1]{Presentation End}{presentationEnd}%
\strut\par\bigskip\par\strut%%
\parbox{0.4\paperwidth}{%
\scalebox{2}{\textbf{\LARGE{\zh{谢谢！}}}}\bigskip\par%
\scalebox{1.2}{\textbf{\LARGE{Thank you.}}}\bigskip\par%
\insertauthor\bigskip\par%
\insertinstitute%
}%
\end{frame}%
%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\pgfuseimage{ustc_slides_background}}%
%
%
\begin{frame}%%
\frametitle{\bibname}%
\pdfbookmark[1]{\bibname}{bibliographyZ}%
\begin{center}%
\strut\vfill\par%
\includegraphics[width=0.5\paperwidth]{\sharedPath/graphics/ustc_slides_bibliography/ustc_slides_bibliography}%
\par\vfill\strut%
\end{center}%
\end{frame}%
%
\section*{\bibname}%
\def\newblock{\beamer@newblock}%
%
\begin{frame}[allowframebreaks,t]{\bibname}%
\begin{tiny}%
\bibliographystyle{unsrtnat}%
\bibliography{\sharedPath/bibliography/bibliography}%
\end{tiny}%
\end{frame}%
%
\global\let\@framePatch\@framePatch@addBookmarks%
%
}%
%
%
%%%
%%% Bibliography commands
%%%
%
%
\let\@bib@oldcite\cite%
\let\@bib@oldcitep\citep%
\let\@bib@oldcitet\citet%
\let\@bib@oldcitete\citete%
\let\@bib@oldCitet\Citet%
\let\@bib@oldCitete\Citete%
%
\gdef\cite#1{\textsuperscript{\textnormal{\scalebox{0.75}{\color{footerdarkblue}{\@bib@oldcite{#1}}}}}}%
\gdef\citep#1{\textsuperscript{\textnormal{\scalebox{0.75}{\color{footerdarkblue}{\@bib@oldcitep{#1}}}}}}%
\gdef\scitep#1{\textsuperscript{\textnormal{\scalebox{0.75}{~\color{footerdarkblue}{\@bib@oldcitep{#1}}}}}}%
\gdef\citet#1{\citeauthor{#1}~\citep{#1}}%
\gdef\Citet#1{\Citeauthor{#1}~\citep{#1}}%
\gdef\citete#1#2{\citeauthor{#1}~\citep{#2}}%
\gdef\Citete#1#2{\Citeauthor{#1}~\citep{#2}}%
%
%%%
%%% Make each slide have an entry in the pdf bookmarks
%%%
\def\@framePatch@addBookmarks#1{\bookmark[page=\the\c@page,level=3]{#1}}%
\def\@framePatch@doNothing#1{}%
\let\@framePatch\@framePatch@addBookmarks%
\apptocmd{\beamer@@frametitle}{\only<1>{\@framePatch{#1}}}%
{\message{** patching of \string\beamer@@frametitle succeeded **}}%
{\message{** patching of \string\beamer@@frametitle failed **}}%

